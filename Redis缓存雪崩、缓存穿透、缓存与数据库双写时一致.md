---
title: Redis缓存雪崩、缓存穿透、缓存与数据库双写时一致
date: 2018-07-07 21:56:29
tags: 
 - Redis
 - 缓存雪崩
 - 缓存穿透
 - 缓存与数据库双写一致
 - Redis面试题
---
# 关于Redis缓存雪崩、缓存穿透、缓存与数据库双写时一致的理解

## 一、缓存雪崩

### 什么是缓存雪崩？

回顾一下，我们为什么要用缓存（Redis）：



现在有个问题，如果我们的缓存挂掉了，这意味着我们的全部请求都跑到数据库了。



在前面学习我们都知道Redis不可能把所有的数据都缓存起来（内存昂贵且有限），所以Redis需要对数据设置过期时间，并采用的是惰性删除 + 定期删除两种策略对过期键删除。

如果缓存数据设置的过期时间是相同的，并且Redis恰好将这部分数据全部删光了。这就会导致在这段时间内，这些缓存同时失效，全部请求到数据库中。这就是**缓存雪崩**：

Redis挂掉了，请求全部走数据库。

对缓存数据设置相同的过期时间，导致某段时间内缓存失效，请求全部走数据库。

缓存雪崩如果发生了，很可能就把我们的数据库搞垮，导致整个服务器瘫痪！



### 如何解决缓存雪崩？

对于”对缓存数据设置相同的过期时间，导致某段时间内缓存失效，请求全部走数据库。“这种情况，非常好解决：

解决方法：在缓存的时候给过期时间加上一个随机值，这样就会大幅度的减少缓存在同一时间过期。

对于“Redis挂掉了，请求全部走数据库”这种情况，我们可以有以下的思路：

事发前：实现Redis的高可用（主从架构 + Sentinel 或者 Redis Cluster），尽量避免Redis挂掉这种情况发生。

事发中：万一Redis真的挂了，我们可以设置本地缓存（ehcache） + 限流（hystrix），尽量避免我们的数据库被干掉（起码能保证我们的服务还是能正常工作的）

事发后：redis持久化，重启后自动从磁盘上加载数据，快速恢复缓存数据。

## 二、缓存穿透

### 什么是缓存穿透？

### 如何解决缓存穿透？

## 三、缓存与数据库双写一致

### 对于读操作，流程是这样的

### 什么是缓存与数据库双写一致问题？

 ### 对于更新操作

#### 操作缓存

* 更新缓存
* 删除缓存

#### 先更新数据库，再删除缓存

#### 先删除缓存，再更新数据库

### 对比两种策略

### 其他保障数据一致的方案与资料

